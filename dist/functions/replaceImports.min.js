"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.replaceImports=exports.default=void 0;var _strBeforeLast=_interopRequireDefault(require("../utilities/strBeforeLast")),_makeFilepath=_interopRequireDefault(require("../utilities/makeFilepath")),_testFilesystem=require("test-filesystem"),_main=_interopRequireDefault(require("../main")),_regexEscape=_interopRequireDefault(require("../utilities/regexEscape")),_makeRelativePath=_interopRequireDefault(require("../utilities/makeRelativePath"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const replaceImports=(e,t,r,s={})=>(r,i)=>{if(!i.file)return console.error("Unable to find module",e,i),r;let a=(0,_makeRelativePath.default)(e,i.file),l=t;(l.endsWith(".js")||l.endsWith(".mjs"))&&(l=(0,_strBeforeLast.default)(l,"/"));let u=(0,_makeFilepath.default)(l,a);u.endsWith(".mjs")&&(u=(0,_strBeforeLast.default)(u,".mjs")+".js"),(0,_testFilesystem.fileExists)(u)||((u.endsWith(".js")||u.endsWith(".mjs"))&&(u=(0,_strBeforeLast.default)(u,"/")),(0,_main.default)(i.file,u,s));const o=(0,_regexEscape.default)(i.module),f=new RegExp(`(['"\`])${o}['"\`]`);if(i.module.includes("${")){const e=o.replace(/(\\\$\\{.+\\})+/g,".+"),t=new RegExp(`(.+/)(${e})(/.+)`,"g");a=a.replace(t,"$1"+i.module+"$3")}return a.endsWith(".mjs")&&(a=(0,_strBeforeLast.default)(a,".mjs")+".js"),r.replace(f,`$1${a}$1`)};exports.replaceImports=replaceImports;var _default=exports.default=replaceImports;