"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.replaceImports=exports.default=void 0;var _strBeforeLast=_interopRequireDefault(require("../utilities/strBeforeLast")),_makeFilepath=_interopRequireDefault(require("./makeFilepath")),_fileExists=_interopRequireDefault(require("./fileExists")),_makeCommon=_interopRequireDefault(require("./makeCommon")),_regexEscape=_interopRequireDefault(require("./regexEscape")),_makeRelativePath=_interopRequireDefault(require("./makeRelativePath"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const replaceImports=(e,t,r,a={})=>(r,l)=>{if(!l.file)return console.error("Unable to find module",e,l),r;let i=(0,_makeRelativePath.default)(e,l.file),s=t;(s.endsWith(".js")||s.endsWith(".mjs"))&&(s=(0,_strBeforeLast.default)(s,"/"));let u=(0,_makeFilepath.default)(s,i);u.endsWith(".mjs")&&(u=(0,_strBeforeLast.default)(u,".mjs")+".js"),(0,_fileExists.default)(u)||((u.endsWith(".js")||u.endsWith(".mjs"))&&(u=(0,_strBeforeLast.default)(u,"/")),(0,_makeCommon.default)(l.file,u,a));const o=(0,_regexEscape.default)(l.module),f=new RegExp(`(['"\`])${o}['"\`]`);if(l.module.includes("${")){const e=o.replace(/(\\\$\\{.+\\})+/g,".+"),t=new RegExp(`(.+/)(${e})(/.+)`,"g");i=i.replace(t,"$1"+l.module+"$3")}return r.replace(f,`$1${i}$1`)};exports.replaceImports=replaceImports;var _default=exports.default=replaceImports;