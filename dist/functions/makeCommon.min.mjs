import{dest,src}from"gulp";import babel from"gulp-babel";import through from"through2";import strAfterLast from"../utilities/strAfterLast";import resolveImports from"./resolveImports.mjs";import replaceImports from"./replaceImports.mjs";import replaceImportMeta from"./replaceImportMeta.mjs";import wrapAwait from"./wrapAwait.mjs";import copyResources from"./copyResources.mjs";export const makeCommon=(t,r,o={})=>src(t).pipe(through.obj((function(e,p,s){const m=resolveImports(e).reduce(replaceImports(t,r,e,o),e.contents.toString());copyResources(t,o),e.contents=Buffer.from(m),this.push(e),s()}))).pipe(babel()).pipe(through.obj((function(t,r,o){let e=t.contents.toString();e=replaceImportMeta(e);const p=wrapAwait(e,strAfterLast(t.base,"/"));t.contents=Buffer.from(p),this.push(t),o()}))).pipe(dest(r));export default makeCommon;