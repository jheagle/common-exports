import{dest,src}from"gulp";import babel from"gulp-babel";import through from"through2";import strAfterLast from"../utilities/strAfterLast";import resolveImports from"./resolveImports.mjs";import replaceImports from"./replaceImports.mjs";import replaceImportMeta from"./replaceImportMeta.mjs";import wrapAwait from"./wrapAwait.mjs";import copyResources from"./copyResources.mjs";export const makeCommon=(t,o,r={})=>src(t).pipe(through.obj((function(e,p,s){const m=void 0===r.rootPath?t:r.rootPath,a=resolveImports(e,m).reduce(replaceImports(t,o,e,r),e.contents.toString());copyResources(t,r),e.contents=Buffer.from(a),this.push(e),s()}))).pipe(babel()).pipe(through.obj((function(t,o,r){let e=t.contents.toString();e=replaceImportMeta(e);const p=wrapAwait(e,strAfterLast(t.base,"/"));t.contents=Buffer.from(p),this.push(t),r()}))).pipe(dest(o));export default makeCommon;