import strBeforeLast from"../utilities/strBeforeLast";import makeFilepath from"./makeFilepath.mjs";import fileExists from"./fileExists.mjs";import makeCommon from"./makeCommon.mjs";import regexEscape from"./regexEscape.mjs";import makeRelativePath from"./makeRelativePath.mjs";export const replaceImports=(e,t,s,m={})=>(s,r)=>{if(!r.file)return console.error("Unable to find module",e,r),s;let o=makeRelativePath(e,r.file),a=t;(a.endsWith(".js")||a.endsWith(".mjs"))&&(a=strBeforeLast(a,"/"));let i=makeFilepath(a,o);i.endsWith(".mjs")&&(i=strBeforeLast(i,".mjs")+".js"),fileExists(i)||((i.endsWith(".js")||i.endsWith(".mjs"))&&(i=strBeforeLast(i,"/")),makeCommon(r.file,i,m));const l=regexEscape(r.module),p=new RegExp(`(['"\`])${l}['"\`]`);if(r.module.includes("${")){const e=l.replace(/(\\\$\\{.+\\})+/g,".+"),t=new RegExp(`(.+/)(${e})(/.+)`,"g");o=o.replace(t,"$1"+r.module+"$3")}return s.replace(p,`$1${o}$1`)};export default replaceImports;