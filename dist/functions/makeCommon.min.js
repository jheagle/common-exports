"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeCommon=exports.default=void 0,require("core-js/modules/esnext.async-iterator.reduce.js"),require("core-js/modules/esnext.iterator.constructor.js"),require("core-js/modules/esnext.iterator.reduce.js");var _gulp=require("gulp"),_gulpBabel=_interopRequireDefault(require("gulp-babel")),_through=_interopRequireDefault(require("through2")),_strAfterLast=_interopRequireDefault(require("../utilities/strAfterLast")),_resolveImports=_interopRequireDefault(require("./resolveImports")),_replaceImports=_interopRequireDefault(require("./replaceImports")),_replaceImportMeta=_interopRequireDefault(require("./replaceImportMeta")),_wrapAwait=_interopRequireDefault(require("./wrapAwait")),_copyResources=_interopRequireDefault(require("./copyResources"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const makeCommon=(e,r,t={})=>(0,_gulp.src)(e).pipe(_through.default.obj((function(o,u,s){const a=void 0===t.rootPath?e:t.rootPath,i=(0,_resolveImports.default)(o,a).reduce((0,_replaceImports.default)(e,r,o,t),o.contents.toString());(0,_copyResources.default)(e,t),o.contents=Buffer.from(i),this.push(o),s()}))).pipe((0,_gulpBabel.default)()).pipe(_through.default.obj((function(e,r,t){let o=e.contents.toString();o=(0,_replaceImportMeta.default)(o);const u=(0,_wrapAwait.default)(o,(0,_strAfterLast.default)(e.base,"/"));e.contents=Buffer.from(u),this.push(e),t()}))).pipe((0,_gulp.dest)(r));exports.makeCommon=makeCommon;var _default=exports.default=makeCommon;