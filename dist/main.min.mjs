import babel from"gulp-babel";import{copyResources}from"./functions/copyResources.mjs";import{dest,src}from"gulp";import{replaceImports}from"./functions/replaceImports.mjs";import{replaceImportMeta}from"./functions/replaceImportMeta.mjs";import{resolveImports}from"./functions/resolveImports.mjs";import{strAfterLast}from"./utilities/strAfterLast.mjs";import through from"through2";import{wrapAwait}from"./functions/wrapAwait.mjs";import{customChanges}from"./functions/customChanges.mjs";export const makeCommon=(t,o,r={})=>src(t).pipe(through.obj((function(s,e,m){const p=void 0===r.rootPath?t:r.rootPath,c=resolveImports(s,p).reduce(replaceImports(t,o,s,r),s.contents.toString());copyResources(t,r),s.contents=Buffer.from(customChanges(t,c,r)),this.push(s),m()}))).pipe(babel()).pipe(through.obj((function(t,o,r){let s=t.contents.toString();s=replaceImportMeta(s);const e=wrapAwait(s,strAfterLast(t.base,"/"));t.contents=Buffer.from(e),this.push(t),r()}))).pipe(dest(o));