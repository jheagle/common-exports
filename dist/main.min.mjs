import babel from"gulp-babel";import{copyResources}from"./functions/copyResources.mjs";import{dest,src}from"gulp";import{replaceImports}from"./functions/replaceImports.mjs";import{replaceImportMeta}from"./functions/replaceImportMeta.mjs";import{resolveImports}from"./functions/resolveImports.mjs";import through from"through2";import{customChanges}from"./functions/customChanges.mjs";export const makeCommon=(o,t,r={})=>src(o).pipe(through.obj((function(e,s,p){const m=void 0===r.rootPath?o:r.rootPath,c=resolveImports(e,m).reduce(replaceImports(o,t,r),e.contents.toString());copyResources(o,r),e.contents=Buffer.from(customChanges(o,c,r)),this.push(e),p()}))).pipe(babel()).pipe(through.obj((function(o,t,r){o.contents=Buffer.from(replaceImportMeta(o.contents.toString())),this.push(o),r()}))).pipe(dest(t));