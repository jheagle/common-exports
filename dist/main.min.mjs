import babel from"gulp-babel";import copyResources from"./functions/copyResources.mjs";import{dest,src}from"gulp";import replaceImports from"./functions/replaceImports.mjs";import replaceImportMeta from"./functions/replaceImportMeta.mjs";import resolveImports from"./functions/resolveImports.mjs";import strAfterLast from"./utilities/strAfterLast.mjs";import through from"through2";import wrapAwait from"./functions/wrapAwait.mjs";export const makeCommon=(t,o,r={})=>src(t).pipe(through.obj((function(e,s,p){const m=void 0===r.rootPath?t:r.rootPath,i=resolveImports(e,m).reduce(replaceImports(t,o,e,r),e.contents.toString());copyResources(t,r),e.contents=Buffer.from(i),this.push(e),p()}))).pipe(babel()).pipe(through.obj((function(t,o,r){let e=t.contents.toString();e=replaceImportMeta(e);const s=wrapAwait(e,strAfterLast(t.base,"/"));t.contents=Buffer.from(s),this.push(t),r()}))).pipe(dest(o));export default makeCommon;