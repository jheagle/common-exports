"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeCommon=void 0,require("core-js/modules/esnext.async-iterator.reduce.js"),require("core-js/modules/esnext.iterator.constructor.js"),require("core-js/modules/esnext.iterator.reduce.js");var _gulpBabel=_interopRequireDefault(require("gulp-babel")),_copyResources=require("./functions/copyResources"),_gulp=require("gulp"),_replaceImports=require("./functions/replaceImports"),_replaceImportMeta=require("./functions/replaceImportMeta"),_resolveImports=require("./functions/resolveImports"),_strAfterLast=require("./utilities/strAfterLast"),_through=_interopRequireDefault(require("through2")),_wrapAwait=require("./functions/wrapAwait"),_customChanges=require("./functions/customChanges");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const makeCommon=(e,r,t={})=>(0,_gulp.src)(e).pipe(_through.default.obj((function(o,s,u){const p=void 0===t.rootPath?e:t.rootPath,a=(0,_resolveImports.resolveImports)(o,p).reduce((0,_replaceImports.replaceImports)(e,r,o,t),o.contents.toString());(0,_copyResources.copyResources)(e,t),o.contents=Buffer.from((0,_customChanges.customChanges)(e,a,t)),this.push(o),u()}))).pipe((0,_gulpBabel.default)()).pipe(_through.default.obj((function(e,r,t){let o=e.contents.toString();o=(0,_replaceImportMeta.replaceImportMeta)(o);const s=(0,_wrapAwait.wrapAwait)(o,(0,_strAfterLast.strAfterLast)(e.base,"/"));e.contents=Buffer.from(s),this.push(e),t()}))).pipe((0,_gulp.dest)(r));exports.makeCommon=makeCommon;