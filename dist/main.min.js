"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeCommon=exports.default=void 0,require("core-js/modules/esnext.async-iterator.reduce.js"),require("core-js/modules/esnext.iterator.constructor.js"),require("core-js/modules/esnext.iterator.reduce.js");var _gulpBabel=_interopRequireDefault(require("gulp-babel")),_copyResources=_interopRequireDefault(require("./functions/copyResources")),_gulp=require("gulp"),_replaceImports=_interopRequireDefault(require("./functions/replaceImports")),_replaceImportMeta=_interopRequireDefault(require("./functions/replaceImportMeta")),_resolveImports=_interopRequireDefault(require("./functions/resolveImports")),_strAfterLast=_interopRequireDefault(require("./utilities/strAfterLast")),_through=_interopRequireDefault(require("through2")),_wrapAwait=_interopRequireDefault(require("./functions/wrapAwait"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const makeCommon=(e,t,r={})=>(0,_gulp.src)(e).pipe(_through.default.obj((function(o,u,s){const i=void 0===r.rootPath?e:r.rootPath,a=(0,_resolveImports.default)(o,i).reduce((0,_replaceImports.default)(e,t,o,r),o.contents.toString());(0,_copyResources.default)(e,r),o.contents=Buffer.from(a),this.push(o),s()}))).pipe((0,_gulpBabel.default)()).pipe(_through.default.obj((function(e,t,r){let o=e.contents.toString();o=(0,_replaceImportMeta.default)(o);const u=(0,_wrapAwait.default)(o,(0,_strAfterLast.default)(e.base,"/"));e.contents=Buffer.from(u),this.push(e),r()}))).pipe((0,_gulp.dest)(t));exports.makeCommon=makeCommon;var _default=exports.default=makeCommon;